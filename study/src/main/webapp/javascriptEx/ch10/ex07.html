<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="icon" href="data:;base64,iVBORw0KGgo=">
<style type="text/css">
.container { width: 800px; margin: 30px auto; }

div#image-zone * { box-sizing: border-box; }
div#image-zone {
	width: 750px;
	min-height: 130px;
	display: grid;
	grid-template-columns: repeat(5, 1fr);
	grid-gap: 5px;
	align-items: center;
	border: 1px dotted #00f;
	margin-top: 5px;
	padding: 5px;
}

div#image-zone:empty:before {
	content:attr(data-placeholder);
	color: #999;
	font-size: .9rem;
	text-align: center;
	width: 700px;
}

img.image {
	object-fit: cover;
	width: 140px;
	height: 120px;
	cursor: pointer;
	border: 1px solid #eee;
	border-radius: 3px;
}

img.image:hover {
	scale:100.5%;
}

</style>

</head>
<body>

	<div class="container">
		<h3>ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°</h3>
		<form name="frm">
			<input type="file" name="selectFile" id="selectFile" multiple>
			<div id="image-zone" 
				data-placeholder="ì´ê³³ì— íŒŒì¼ì„ ë“œë˜ê·¸&ë“œë¡­ í•˜ì„¸ìš”."></div>
		</form>
	</div>
	
	<script type="text/javascript">
		const preImageViewer = (imageZoneSelector, inputSelector) => {
			const imageZoneEL = document.querySelector(imageZoneSelector);
			const inputEL = document.querySelector(inputSelector);
			
			let sel_files = [];
			
			const imageAppend = function(imgEL, file) {
				imgEL.onclick = e => {
					if(! confirm('ì´ë¯¸ì§€ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ ?')) {
							return false;	
						}
					
					let target = e.target;
					let filename = target.getAttribute('data-filename');
					alert(filename);
					for(let i = 0; i < sel_files.length; i++) {
						if(filename === sel_files[i].name ) {
							sel_files.splice(i, 1);
						} 
					}
					
					let dt = new DataTransfer();
					for(let f of sel_files) {
						dt.items.add(f);
					}
					inputEL.files = dt.files;
					
					imageZoneEL.removeChild(imgEL);
					
				};
				
				transfer();
				
				imageZoneEL.appendChild(imgEL);
			};
			
			// ì²¨ë¶€ëœ ì´ë¯¸ì§€ë¥¼ ë°°ì—´ì— ë„£ê³  ë¯¸ë¦¬ë³´ê¸°
			const imageLoader = file => {								
				for(let f of sel_files) {
					if(f.name === file.name) {
						transfer();
						return;
					}
				}
				
				/*
			    // ğŸ”’ ì¤‘ë³µ ë°©ì§€: sel_files ì•ˆì— ê°™ì€ ì´ë¦„ì˜ íŒŒì¼ì´ ìˆëŠ”ì§€ í™•ì¸
			    if (sel_files.some(f => f.name === file.name)) {
			        alert(`'${file.name}' íŒŒì¼ì€ ì´ë¯¸ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
			        return;
			    }
				*/
				
				
				sel_files.push(file);
				
				const reader = new FileReader();
				reader.onload = function(e) {
					let imgEL = document.createElement('img');
					imgEL.classList.add('image');
					imgEL.setAttribute('data-filename', file.name);
					imgEL.src = e.target.result;
					
					imageAppend(imgEL, file);
				};
				
				transfer();
				
				reader.readAsDataURL(file);
			};
			
			// sel_files[] ì— ì €ì¥ëœ file ê°ì²´ë¥¼ <input type="file">ë¡œ ì „ì†¡í•˜ê¸°
			const transfer = () => {
				let dt = new DataTransfer();
				for(let f of sel_files) {
					dt.items.add(f);
				}
				inputEL.files = dt.files;
			}
			
			inputEL.onchange = e => {
				const files = e.target.files;
				
				/*
				// beginì—ì„œ end-1 ì¸ë°ìŠ¤ê¹Œì§€ ìš”ì†Œë¥¼ ì–•ì€ ë³µì‚¬í•˜ì—¬ ìƒˆë¡œìš´ ë°°ì—´ì„ ë§Œë“¬
				const arr = Array.prototype.slice.call(files);
				for(let f of arr) {
					imageLoader(f);
				}
				*/
				
				if(! e.target.files.length) {
					transfer();
					return;
				}
				
				for(let f of files) {
					imageLoader(f);
				}
			};
			
			imageZoneEL.addEventListener('dragenter', e => {
				// ë“œë¡­ ëŒ€ìƒìœ„ì— ì˜¬ë¼ê°”ì„ë•Œ ë°œìƒ
				e.preventDefault();
				e.stopPropagation();
			});
			
			imageZoneEL.addEventListener('dragover', e => {
				// ë“œë¡­ ëŒ€ìƒìœ„ë¡œ ì§€ë‚˜ê°ˆë•Œ ë°œìƒ
				e.preventDefault();
				e.stopPropagation();
			});

			imageZoneEL.addEventListener('drop', e => {
				// drop : ë“œë˜ê·¸í• ë•Œ ë°œìƒ
				e.preventDefault();
				e.stopPropagation();
				
				let files = [];
				// dataTransfer : ë“œë˜ê·¸ì¤‘ì¸ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê±°ë‚˜ ì „ì†¡í•˜ëŠ” ê°ì²´ 
				let dt = e.dataTransfer;
				files = dt.files;
				for(let f of files) {
					imageLoader(f);
				}
			});
			
		};  
		
		window.addEventListener('load', function() {
			preImageViewer('#image-zone', '#selectFile');
		});
		
	</script>

</body>
</html>